{% comment %}
#
# Copyright Â© 2012 Red Hat, Inc.
#
# This software is licensed to you under the GNU General Public
# License as published by the Free Software Foundation; either version
# 2 of the License (GPLv2) or (at your option) any later version.
# There is NO WARRANTY for this software, express or implied,
# including the implied warranties of MERCHANTABILITY,
# NON-INFRINGEMENT, or FITNESS FOR A PARTICULAR PURPOSE. You should
# have received a copy of GPLv2 along with this software; if not, see
# http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.
{% endcomment %}
<html>
    <head>
        <link href="https://access.redhat.com/chrome_themes/umbra/s/global.css?version=1.6.5.2" media="screen, print" type="text/css" rel="stylesheet"/>
        <link href="https://access.redhat.com/chrome_themes/umbra/s/print.css?version=1.6.5.2" media="print" type="text/css" rel="stylesheet"/>
        <link href="https://access.redhat.com/webassets/avalon/s/jquery-ui/cp/jquery-ui-1.8.7.custom.css?version=1.6.5.2" media="screen, print" type="text/css" rel="stylesheet"/>
        <link href="{{ STATIC_URL }}jquery.jqplot.min.css" type="text/css" rel="stylesheet"/>
        <link href="{{ STATIC_URL }}chosen.css" type="text/css" rel="stylesheet"/>
        
        <script src="{{ STATIC_URL }}jquery.min.js"></script>
        <script src="{{ STATIC_URL }}jquery-ui.min.js"></script>
        <script src="{{ STATIC_URL }}jquery-csrf.js"></script>
        <script src="{{ STATIC_URL }}jquery.jqplot.min.js"></script>
        <script src="{{ STATIC_URL }}jqplot.canvasTextRenderer.min.js"></script>
        <script src="{{ STATIC_URL }}jqplot.canvasAxisLabelRenderer.min.js"></script>
        <script src="{{ STATIC_URL }}chosen.jquery.js"></script>
        <script src="http://datatables.net/download/build/jquery.dataTables.min.js"></script>
        <script src="{{ STATIC_URL }}TableTools.min.js"></script>
        <script>
            var first_logged_in = false;
            var logged_in = false;
			var csrftoken = '';
            var page_size = 10; // default value

            $(document).ready(function() {
				csrftoken = getCookie('csrftoken');
                setupLoginForm();
                setupLLButtons();
				setupNavButtons();
                setupCreateForm();
                openCreate();
                $('#login-button').click(login);
                $('#logout-button').click(logout);

                // initially hide instance detail section
                $('#instance_details').hide();

				// Disable appropriate nav tabs 
				$('#report_button').addClass('disabled');
				$('#detail_button').addClass('disabled');
				$('#max_button').addClass('disabled');

				$('#report_button').off('click');
				$('#detail_button').off('click');
				$('#max_button').off("click");
				
				$('#contract').change(function() {
					$('#rhic').val('').trigger('liszt:updated');
				});
				
				$('#rhic').change(function() {
					$('#contract').val('').trigger('liszt:updated');
					
				});
				
				$("#byMonth").change(function() {
					$("#startDate").val('').trigger('liszt:updated');
	                $("#endDate").val('').trigger('liszt:updated');
				});
				
				$("#startDate").change(function() {
					$("#byMonth").val('').trigger('liszt:updated');
				});
				
				$("#endDate").change(function() {
					$("#byMonth").val('').trigger('liszt:updated');
				});
				
				
                

				// Is there a way to disable :hover event as well?
				
            });
            

            function login() {
                $('#login-form').dialog('open');
            }

            function logout() {
                $.ajax({
                    url: '/report-server/ui20/logout/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: {},
					crossDomain: false,
					beforeSend: function(xhr, settings) {
						if (!csrfSafeMethod(settings.type)) {
							xhr.setRequestHeader("X-CSRFToken", csrftoken);
						}
					}
				}).done(function(data) {
                    enableButton($('#login-button'));
                    disableButton($('#logout-button'));
                    // alter msg
                    $('#account-links > span > p').text('You are not logged in.');

                    logged_in = false;

                    loadContent();
                }).fail(function(jqXHR) {
                    // TODO: Add error handling here
                });
            }

            function setupLLButtons() {
                if (first_logged_in) {
                    disableButton($('#login-button'));
                    logged_in = true;
                } else {
                    disableButton($('#logout-button'));
                    logged_in = false;
                }
                loadContent();
                $('#login-error').hide();
            }

			function setupNavButtons() {
				$('#create_button').on("click", openCreate);
				$('#report_button').on("click", openReport);
				$('#detail_button').on("click", openDetail);
				$('#import_button').on("click", openImport);
				$('#max_button').on("click", openMax);
			}

            function setupCreateForm() {
				$('#report_form').each(function() {
					this.reset();
				});

                $('#startDate').attr('disabled', false);
                $('#endDate').attr('disabled', false);
                $('#rhic').attr('disabled', false);
                $('#contract').attr('disabled', false);
				$("#startDate").attr('disabled', false);
				$("#endDate").attr('disabled', false);
				$("#byMonth").attr('disabled', false);
				$("#env").attr('disabled', false);


                $('#startDate').datepicker();
                $('#endDate').datepicker();

                setupCreateFormButtons();

                $.ajax({
                    url: '/report-server/ui20/report_form/',
                    type: 'GET',
                    contentType: 'application/json',
                    data: {},
                    crossDomain: false,
                    beforeSend: function(xhr, settings) {
                            if (!csrfSafeMethod(settings.type)) {
                                xhr.setRequestHeader("X-CSRFToken", csrftoken);
                            }
                        }
                    }).done(function(data) {
                    	
                        fill_create_report_form(JSON.parse(data));
                    	//fill_create_report_rhic_form(JSON.parse(data));
                        $('#contract').chosen();
                    	$('#rhic').chosen();
                    	$('#byMonth').chosen();
                    	$('#env').chosen();
                    }).fail(function(jqXHR) {
                        // TODO: Add error handling here
                });
            }


            function setupCreateFormButtons() {
                var btn = $('#clear');
                var o = $('#original');
                var c = $('#choices');
                // Initially hide the choices
                c.hide();
            }

			function createReport(event) {
				// Have to stop url from changing so disable default event
				event.preventDefault();

                if (logged_in && validateForm()) {
					// Build up var
               	    var data = {}; 
					
					// Date section
                    if($.trim($('#byMonth').val()) != "-1") {
                    	data['byMonth'] = $('#byMonth').val();
                    }
                    if($.trim($('#startDate').val()) != "") {
                    	data['startDate'] = $('#startDate').val();
    					data['endDate'] = $('#endDate').val();
                    }
                    if($.trim($('#contract').val()) != "") {
                    	data['contract_number'] = $('#contract').val();
                    }
                    if($.trim($('#rhic').val()) != "") {
                    	data['rhic'] = $('#rhic').val();
                    }
					
					data['env'] = $('#env').val();

                    $.ajax({
                        url: '/report-server/ui20/report/',
                        type: 'POST',
                        contentType: 'application/json',
                        data: data,
						crossDomain: false,
						beforeSend: function(xhr, settings) {
							if (!csrfSafeMethod(settings.type)) {
								xhr.setRequestHeader("X-CSRFToken", csrftoken);
							}
						}
					}).done(function(data) {
                        var rtn = jQuery.parseJSON(data);
                        populateReport(rtn);
                        openReport();
						// Attach the event handler back on
						$('#report_button').on("click", openReport);
                    }).fail(function(jqXHR, textStatus, errorThrown) {
                        // TODO: Add error handling here
                    });
                }
            }

            function resetReportForm(event) {
                $('#report_pane > div').empty();
                $('#report_pane > div').append($('<h3>This date range contains no usage data.</h3>'));
                $('#report_pane > div').append($('<br></br>'));
                $('#report_pane > div').append($('<br></br>'));
                $('#details > table').empty();
                $('#instance_details').empty();
                $('#max_details').empty();
                

				// Disable appropriate nav tabs 
				$('#report_button').addClass('disabled');
				$('#detail_button').addClass('disabled');
				$('#max_button').addClass('disabled');

				$('#report_button').off('click');
				$('#detail_button').off('click');
				$('#max_button').off("click");
            }

            // There has to be a better way to make the
            // next four function generic.

            function openCreate() {
				removeActiveNav();
				$('#create_button').addClass('active');
    
                if (logged_in) {
                    $('#create_pane').show();
                    $('#report_pane').hide();
                    $('#detail_pane').hide();
                    $('#max_pane').hide();
                    $('#import_pane').hide();
                    
                }
            }

            function openReport() {
				$('#report_button').removeClass('disabled');
				removeActiveNav();
				$('#report_button').addClass('active');
    
                if (logged_in) {
                    $('#create_pane').hide();
                    $('#report_pane').show();
                    $('#detail_pane').hide();
                    $('#import_pane').hide();
                    $('#max_pane').hide();
                }
            }

            function openDetail() {
				$('#detail_button').removeClass('disabled');
				removeActiveNav();
				$('#detail_button').addClass('active');
                if (logged_in) {
                    $('#create_pane').hide();
                    $('#report_pane').hide();
                    $('#detail_pane').show();
                    $('#import_pane').hide();
                    $('#max_pane').hide();
                }
            }
            
            function openMax() {
				$('#max_button').removeClass('disabled');
				removeActiveNav();
				$('#max_button').addClass('active');
                if (logged_in) {
                    $('#create_pane').hide();
                    $('#report_pane').hide();
                    $('#detail_pane').hide();
                    $('#max_pane').show();
                    $('#import_pane').hide();
                }
            }

            function openImport() {
				removeActiveNav();
				$('#import_button').addClass('active');
    
                if (logged_in) {
                    $('#create_pane').hide();
                    $('#report_pane').hide();
                    $('#detail_pane').hide();
                    $('#max_pane').hide();
                    $('#import_pane').show();
                    
                }
            }

            function createDetail(start, end, filter_args) {
                var data = {
                    "start": start,
                    "end": end,
                    "filter_args_dict": unescape(filter_args)
                };

                $.ajax({
                    url: '/report-server/ui20/details/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: data,
                    crossDomain: false,
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type)) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                }).done(function(data) {
                    var rtn = jQuery.parseJSON(data);
                    populateDetailReport(rtn);
                    openDetail();
				    $('#detail_button').removeClass('disabled');
					$('#detail_button').on("click", openDetail);
                }).fail(function(jqXHR) {
                    // TODO: Add error handling here
                });
            }
            
            

            function createMax(start, end, contract_use, product_config, filter_args) {
                var data = {
                    "start": start,
                    "end": end,
                    "contract_use": contract_use,
                    "product_config": unescape(product_config),
                    "filter_args_dict": unescape(filter_args)
                };

                $.ajax({
                    url: '/report-server/ui20/max_report/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: data,
                    crossDomain: false,
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type)) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                }).done(function(data) {
                    var rtn = jQuery.parseJSON(data);
                    openMax();
                    populateMaxReport(rtn);
					$('#max_button').on("click", openMax);
                }).fail(function(jqXHR) {
                    // TODO: Add error handling here
                });
            }

            function createInstanceDetail(start, end, instance, filter_args) {
                var data = {
                    "start": start,
                    "end": end,
					"instance": instance,
                    "filter_args_dict": unescape(filter_args)
                };

                $.ajax({
                    url: '/report-server/ui20/instance_details/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: data,
                    crossDomain: false,
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type)) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                }).done(function(data) {
                    var rtn = jQuery.parseJSON(data);
                    populateInstanceDetailReport(rtn);
                    openDetail(); // this shouldn't be needed, but no harm in calling it again
					$('#detail_button').on("click", openDetail);
                }).fail(function(jqXHR) {
                    // TODO: Add error handling here
                });
            }
            
            

            function importData() {
                if (logged_in) {
                    $('#import_pane > div').empty();
                    $('#import_pane > button').empty();
                    var status = $('<span class=\'ui-button-text\'>Working on it...</span>');
                    $('#import_pane > button').append(status);

                    $.ajax({
                        url: '/report-server/ui20/import/',
                        type: 'POST',
                        contentType: 'application/json',
                        data: {},
						crossDomain: false,
						beforeSend: function(xhr, settings) {
							if (!csrfSafeMethod(settings.type)) {
								xhr.setRequestHeader("X-CSRFToken", csrftoken);
							}
						}
					}).done(function(data) {
                        var rtn = jQuery.parseJSON(data);
                        
                        
                            var dt = rtn.time[0];
                            if (dt.end < 0){
                            var status = $('<span>Import Skipped, import has been executed in the last 45 minutes<span>');
                            $('#import_pane > div').append(status);
                            }
                            else { 
                                $('#import_pane > div').empty();
                                var status = $('<span>Import Complete!\nStart Time: ' + dt.start + '\nEnd Time: ' + dt.end + '<span>');
                                $('#import_pane > div').append(status);
                            }
                            $('#import_pane > button').empty();
                            var status = $('<span class=\'ui-button-text\'>Import Data</span>');
                            $('#import_pane > button').append(status);
                            
                        
                    }).fail(function(jqXHR) {
                        // TODO: Add error handling here
                    });
                }
            }

            // Support functions, shouldn't be called outside of this HTML.

			function getCookie(name) {
				var cookieValue = null;
				if (document.cookie && document.cookie != '') {
					var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
						var cookie = jQuery.trim(cookies[i]);
						// Does this cookie string begin with the name we want?
						if (cookie.substring(0, name.length + 1) == (name + '=')) {
							cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
							break;
						}
					}
				}
				return cookieValue;
			}

            function setupLoginForm() {
                // Login form
                $('#login-form').dialog({
                    autoOpen: false,
                    height: 300,
                    width: 350,
                    modal: true,
                    buttons: {
                        "Login": function() {
                            var data = {
                                "username": $('#username').val(),
                                "password": $('#password').val()
                            };

                            // Login button in form clicked 
                            $.ajax({
                                url: '/report-server/ui20/login/',
                                type: 'POST',
                                contentType: 'application/json',
                                data: data,
								crossDomain: false,
								beforeSend: function(xhr, settings) {
									if (!csrfSafeMethod(settings.type)) {
										xhr.setRequestHeader("X-CSRFToken", csrftoken);
									}
								}
                            }).done(function(data) {
                                $('#login-error').hide();
                                $('#login-form').dialog('close');
                                // Gray out "Login" button
                                enableButton($('#logout-button'));
                                disableButton($('#login-button'));
                                // alter msg
                                $('#account-links > span > p').text( data );

                                logged_in = true;

                                loadContent();

                            }).fail(function(jqXHR) {
                                $('#login-error').show();
                            });
                        },
                        "Cancel": function() {
                            $('#login-error').hide();
                            $('#login-form').dialog('close');
                        }
                    }
                });
            }

            function fill_create_report_form(data) {
                // Clear outdated elements
                $('#contract').empty();
				$('#rhic').empty();
				$('#env').empty();
				//$('#byMonth').empty();

				// Add defaults
				$('#contract').append($('<option selected value=null></option>'));
				$('#contract').append($('<option value=All>All</option>'));
				

                // Add remainder elements from data
				jQuery.each(data.contracts, function(index, ele) {
					$('#contract').append($('<option value=' + ele + '>' + ele + '</option>'));
				});	
				
				$('#rhic').append($('<option selected value=null></option>'));
				jQuery.each(data.list_of_rhics, function(index, ele) {
					$('#rhic').append($('<option value=' + ele[0] + '>' + ele[1] + '</option>'));
				});	
				
				$('#env').append($('<option value=All>All</option>'));
				jQuery.each(data.environments, function(index, ele) {
					$('#env').append($('<option value=' + ele + '>' + ele + '</option>'));
				});	
				
				var d = new Date();
				var n = d.getMonth() + 1;
				var month=new Array();
				month[1]="January";
				month[2]="February";
				month[3]="March";
				month[4]="April";
				month[5]="May";
				month[6]="June";
				month[7]="July";
				month[8]="August";
				month[9]="September";
				month[10]="October";
				month[11]="November";
				month[12]="December";
				$('#byMonth').append($('<option selected value=' + n + '>' + month[n] + '</option>'));
				
            }
            
         

            function disableButton(btn) {
                btn.attr('disabled', true);
                btn.css('opacity', '0.35');
            }

            function enableButton(btn) {
                btn.removeAttr('disabled');
                btn.css('opacity', '');
            }

            function loadContent() {
                if (!logged_in) {
                    $('#create_pane').hide();
                    $('#report_pane').hide();
                    $('#detail_pane').hide();
                    $('#max_pane').hide();
                    $('#import_pane').hide();

                    $('#navWrap').hide();
                } else {
                    $('#navWrap').show();
                    openCreate();
                    setupCreateForm();
                }
            }

            function removeActiveNav() {
                $('#navPrimary > ul > li').each(
                    function(index) {
                        $(this).removeClass('active');
                    }
                );
            }

            
            function populateReport(rtn) {
                var pane = $('#report_pane > div');

                // cleanup first
                pane.empty();

                if (rtn.list.length > 0) {
                    for (var rhic_index in rtn.list) {
                        var rhic = rtn.list[rhic_index];

                        var table = $('<table class=\'display\' style=\'display: table\' width=\'100%\'></table>');

                        var header = $('<thead></thead>');
                        var header_row = $('<tr></tr>');
                        header_row.append($('<th>Product:</th>'));
                        header_row.append($('<th>SLA:</th>'));
                        header_row.append($('<th>Support:</th>'));
                        header_row.append($('<th>Facts:</th>'));
                        header_row.append($('<th>Contracted Use:</th>'));
                        header_row.append($('<th>NAU:</th>'));
                        

                        header.append(header_row);

                        table.append(header);

                        var tbody = $('<tbody></tbody>');

                        for (var product_index in rhic) {
                            var product = rhic[product_index]; 

                            // insert something if it's the first item
                            if (product_index == 0) {
                                pane.append($('<b>RHIC: ' + product.rhic + ', Contract: ' + product.contract_id + '</b>'));
                            }

                            var row = $('<tr></tr>');
                            row.append($('<td>' + product.product_name + '</td>'));
                            row.append($('<td>' + product.sla + '</td>'));
                            row.append($('<td>' + product.support + '</td>'));
                            row.append($('<td>' + product.facts + '</td>'));
                            row.append($('<td>' + product.contract_use + '</td>'));
                            row.append($('<td>' + product.checkins + '</td>'));
                            

                            row.click(function() {
                                $($('#report_pane').find('tbody')).children().each(function() {
                                    $(this).removeClass('highlighted');
                                });
                                $(this).addClass('highlighted');
                                createDetail(product.start, product.end, escape(new String(product.filter_args_dict)));
                                createMax(product.start, product.end, product.contract_use, escape(new String(product.product_config)), escape(new String(product.filter_args_dict)));
                                
                            });

                            tbody.append(row);
                        }

                        table.append(tbody);

                        pane.append(table);
                        pane.append($('<br></br>'));
                    }
                } else {
                    pane.append($('<h3>This date range contains no usage data.</h3>'));
                    pane.append($('<br></br>'));
                    pane.append($('<br></br>'));
                }
            }
            
            
            function populateMaxReport(rtn) {
                var pane = $('#max_pane');

                // cleanup first
                pane.empty();

                if (rtn.list.length > 0) {
                    var mydata = rtn.list;

                    var table = $('<table id=\'max_data\' class=\'display\' style=\'display: table\' width=\'100%\'></table>');

                    var header = ($('<tr></tr>'));
                    header.append($('<th>Day:</th>'));
                    header.append($('<th>Maximum Daily Usage:</th>'));


                    table.append(header);

                    var tbody = $('<tbody></tbody>');

                    for (var instance_index=0; instance_index <  rtn.list.length; instance_index++) {
                        var instance = rtn.list[instance_index];

                        var row = $('<tr></tr>');
                        row.append($('<td>' + instance['date'] + '</td>'));
                        row.append($('<td>' + instance['count'] + '</td>'));

                        tbody.append(row);
                    }

                    table.append(tbody);

                    pane.append(table);

                    pane.append($('<br></br>'));
                    pane.append($('<div id="chartdiv" style="height:400px;width:100%; "></div>'));
                    var graph_count = rtn.graph_count;
                    var plot1 = $.jqplot('chartdiv', [graph_count]);
                } else {
                    pane.append($('<h3>This date range contains no usage data.</h3>'));
                    pane.append($('<br></br>'));
                    pane.append($('<br></br>'));
                }
            }

            function populateDetailReport(rtn) {
                var pane = $('#details > table');

                // cleanup first
                pane.empty();

                var reportDetailTableData = [];

                detail_table = pane.dataTable({
                    "bAutoWidth": true,
                    "bJQueryUI": true,
                    "aoColumns": [
                        {"sTitle": "Count"},
                        {"sTitle": "UUID"},
                        {"sTitle": "Number of Checkins"}
                    ],
                    "sDom": 'T<"clear">lfrtip',
                    "oTableTools": {
                			"sSwfPath": "{{ STATIC_URL }}copy_csv_xls_pdf.swf",
                			"aButtons": [
                							{
                								"sExtends": "copy",
                								"sButtonText": "Copy to clipboard"
                							},
                							{
                								"sExtends": "csv",
                								"sButtonText": "Save to CSV"
                							},
                							{
                								"sExtends": "pdf",
                								"sButtonText": "Save to PDF"
                							}
                						]
                		}
                });

                for (var instance_index=0; instance_index < rtn.list.length; instance_index++) {
                    var instance = rtn.list[instance_index];

                    var i = instance_index + 1;

                    detail_table.fnAddData([i, instance.instance, instance.count]);
                }

                // attach event
                pane.children('tbody').find('tr').each(function() {
                    $(this).click(function() {
                        $(this).siblings().each(function() {
                            $(this).removeClass('highlighted');
                        });
                        $(this).addClass('highlighted');
                        var instance = $($(this).children('td')[1]).text();
                        createInstanceDetail(rtn.start, rtn.end, instance, escape(new String(rtn.this_filter)));
                    });
                });
                
                
            }

            function populateInstanceDetailReport(rtn) {
                // cleanup
                $('#instance_details').empty();
                var header = $('<b>Number of Checkins</b>');
                var table = $('<table style="width: 100%; margin-bottom: 0;"></table>');
                $('#instance_details').append(header);
                $('#instance_details').append(table);

                var pane = $('#instance_details > table');

                var instanceDetailTableData = [];

                instance_table = pane.dataTable({
                    "bAutoWidth": false,
                    "bJQueryUI": true,
                    "aoColumns": [
                        {"sTitle": "Count"},
                        {"sTitle": "UUID"},
                        {"sTitle": "Product"},
                        {"sTitle": "Time"},
                        {"sTitle": "Products"},
                        {"sTitle": "Memory"},
                        {"sTitle": "CPU Sockets"},
                        {"sTitle": "Reporting Domain"},
                    ],
                    "sDom": 'T<"clear">lfrtip',
                    "oTableTools": {
                			"sSwfPath": "{{ STATIC_URL }}copy_csv_xls_pdf.swf",
                			"aButtons": [
             							{
             								"sExtends": "copy",
             								"sButtonText": "Copy to clipboard"
             							},
             							{
             								"sExtends": "csv",
             								"sButtonText": "Save to CSV"
             							},
             							{
             								"sExtends": "pdf",
             								"sButtonText": "Save to PDF"
             							}
             						]
                		}
                });


                for (var instance_index=0; instance_index <  rtn.list.length; instance_index++) {
                    var instance = rtn.list[instance_index];

                    var i = instance_index + 1;

                    //instanceDetailTableData.push([i, instance.instance_identifier, instance.product_name, instance.hour, instance.product, instance.memtotal, instance.cpu_sockets, instance.environment]);
                    instance_table.fnAddData([i, instance.instance_identifier, instance.product_name, instance.hour, instance.product, instance.memtotal, instance.cpu_sockets, instance.environment]);

                }
                
                // if currently hidden, turn it on
                if (!$('#instance_details').is(':visible')) {
                    $('#instance_details').show();
                }
            }

			function validateForm() {
                var rtn = true;

                $('#form_error').empty();

                if ($('#byMonth').val() > 0 || ($('#startDate').val() && $('#endDate').val())) {
                    // pass
                } else {
                    $('#form_error').append($('<b>Please enter a valid date range or select a month.</b>'));
                    $('#form_error').append($('<br></br>'));
                    rtn = false;
                }

                if ($('#contract').attr('disabled') && $('#rhic').attr('disabled')) {
                    $('#form_error').append($('<b>Please select a Contract or RHIC.</b>'));
                    $('#form_error').append($('<br></br>'));
                    rtn = false;
                } else {
                    // pass
                }
                return rtn;
			}

			function csrfSafeMethod(method) {
				// these HTTP methods do not require CSRF protection
				return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			}
        </script>
        <style>
            #outer-wrapper {
                background: #E6E6E6;
            }
            #navPrimary {
                clear: both;
            }

            input {
                vertical-align: bottom;
            }
            #form_error {
                color: red;
            }
			li.disabled {
				opacity: 0.35;
			}
            div.datatables_sort_wrapper {
                position: relative;
                padding-right: 14px;
                text-align: center;
            }
            div.datatables_sort_wrapper span {
                margin-top: -8px;
                position: absolute;
                right: 0;
                top: 50%;
            }
            table.dataTable td {
                text-align: center;
            }
            tr.highlighted {
                background-color: #A1ACB2 !important;
                color: #FFFFFF;
            }
            .dataTables_wrapper {
                min-height: 0px !important; 
            }
        </style>
    </head>
    <body>
	    <div id="outer-wrapper" class="wrapo">
	        <div id="wrapper" class="wrapo">
            	<div id="header-wrap" class="wrapi">
                	<div id="header">

                    	<div id="brand">
                    		<a id="rhLogo" href="http://www.redhat.com/" title="Go to redhat.com">
                	    		<img src="https://access.redhat.com/chrome_themes/umbra/g/logo_redhat.png" alt="Red Hat logo">
                    		</a>
                    	</div>

                        <div id="utility">
                        	<div id="utility-links">
        		                <div id="account-links" class="account-links" style="display:block">
                        			<span style="color: #FFFFFF;">
                                  		<div style="padding: 4 2;">
                			                <!-- Login Button -->
                                			<button id="login-button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class='ui-button-text'>Login</span></button>
                                			<!-- Logout Button -->
                                 			<button id="logout-button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class='ui-button-text'>Logout</span></button>
                                        </div>

                                        <p>
                            		    {% if user.is_authenticated %}
		                                   
                                            <script type='text/javascript'>
                                                first_logged_in = true;
                                            </script>
		                                {% else %}
                        		            You are not logged in.
                                            <script type='text/javascript'>
                                                first_logged_in = false;
                                            </script>
		                                {% endif %}
                                        </p>
                	            	</span>
                       			</div>
                        	</div>
                        </div>
                        <div id='navWrap' class='clearWrap'>
                            <div id='navPrimary'>
                                <ul>
                                    <!--
                                        Create a much more generic way of attaching and
                                        exercising onclick events.
                                    -->
                                    <li id='create_button' class='active'><a href="#">Create Report</a></li>
                                    <li id='report_button'><a href='#'>View Report</a></li>
                                    <li id='detail_button'><a href='#'>View Detail</a></li>
                                    <li id='max_button'   ><a href="#">Max Data</a></li>
                                    <li id='import_button'><a href="#">Import Data</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div id='main-wrap' class='wrapu'>
                    <div id='main-top'></div>
                    <div class='wrapi'>
                        <div id='container' class='clearWrap'>
                            <div id='create_pane'>
                                <fieldset>
                                    <form id="report_form">
                                     <h2>Filter by Date:</h2>
                                        <table>
                                            <tr>
                                                <td width="10%">
                                                    <div style='display: inline-block'>
                                                        
                                                        <b style='padding-top: 1em'> Month:</b>
                                                        <select name=byMonth id="byMonth" class='chosen' style="width:100px;" disabled="false">
                                                            <option value="-1">Select Month</option>
                                                            <option value="1">January</option>
                                                            <option value="2">February</option>
                                                            <option value="3">March</option>
                                                            <option value="4">April</option>
                                                            <option value="5">May</option>
                                                            <option value="6">June</option>
                                                            <option value="7">July</option>
                                                            <option value="8">August</option>
                                                            <option value="9">September</option>
                                                            <option value="10">October</option>
                                                            <option value="11">November</option>
                                                            <option value="12">December</option>
                                                        </select> 
                                                    </div>
                                                </td>
                                            </tr>
        
                                            <tr>
                                                <td width="50%"> 
                                                    <div style='display: inline-block'>
                                                        
                                                        <b>Custom Range:</b> 
                                                            Start Date: <input type="text" id="startDate" name="startDate">
                                                            End Date: <input type="text" id="endDate" name="endDate"> </p>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
        
                                        <h2>Filter by Customer Data:</h2> 
                                        <table>
                                            <tr>
                                                <td width="5%"> 
                                                    
                                                    <b> Contract: </b> </td> 
                                                    <td width="40%">
                                                        <select id="contract" name=contract_number class='chosen'  style="width:150px;" disabled="false"> 
                                                            
                                                        </select> 
                                                    </td>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td width="5%"> 
                                                    
                                                    <b> RHIC: </b></td>
                                                    <td width="40%">
                                                        <select id="rhic" name="rhic" class='chosen' style="width:400px;" disabled="false">
                                                        </select>
                                                    </td>
                                                </td>
                                            </tr>
                                        </table>
                                        <h2>Filter by Reporting Domain:</h2> 
                                        <table>
                                            <tr> 
                                                <td width="1%"><b>Reporting Domain: </b></td>
                                                    <td width="51%">
                                                        <select id='env' name="env" class='chosen'  style="width:150px;" disabled="false">
                                                            
                                                        </select>
                                                    </td>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td width="5%">
                                                    <button id='submit' name='submit' class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" onclick='createReport(event)'>
                                                        <span class='ui-button-text'>Run Report</span>
                                                    </button>
                                                </td>
                                                <td width="5%">
                                                    <button id='clear' class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" onclick='resetReportForm()'>
                                                        <div id='original'>
                                                            <span class='ui-button-text original' style='float:left'>Reset Form</span>
                                                        </div>
                                                        <div id='choices'>
                                                            <span class='ui-button-text' style='float:left'>Yes</span>
                                                            <span class='ui-button-text' style='float:left'>No</span>
                                                        </div>
                                                    </button>
                                                </td>
                                            </tr>
                                        </table>
                                        <div id='form_error'>
                                        </div>
                                    </form>
                                </fieldset>
                            </div>
                            <div id='report_pane'>
                                <div>
                                    <h3>This date range contains no usage data.</h3>
                                    <br></br>
                                    <br></br>
                                </div>
                                    <button id='createAnotherReport_button' class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" onclick='openCreate()'>
                                        <span class='ui-button-text'>Run another report</span>
                                    </button>
                                <table width="100%">
                                    <tbody>
                                        <tr>
                                            <td><h3>Glossary:</h3></td>
                                        </tr>
                                        <tr>
                                        <td width="15%">SLA :</td>
                                        <td>Service level agreement as defined in the customers contract</td>
                                        </tr>
                                        <tr>
                                        <td width="15%">Support :</td>
                                        <td>Support parameters as defined in the customers contract</td>
                                        </tr>
                                        <tr>
                                        <tr>
                                        <td width="15%">Facts :</td>
                                        <td>Characteristics of both hardware and software of the resource</td>
                                        </tr>
                                        <tr>
                                            <td width="15%">Contracted Use:</h3></td>
                                            <td>This is the number of concurrent entitlements purchased in the contract</td>
                                        </tr>
                                        <tr>
                                            <td width="15%">NAU:</td>
                                            <td>Net Aggregate Usage, is the number of concurrent entitlements actually being consumed</td>
                                        </tr>
                                        <tr>
                                            <td width="15%">Consumed :</td>
                                            <td>Defined as an entitlement being installed and running on an instance or physical machine. If an instance is not running ( ie.. shutdown or terminated), then it is not counted as consumed</td>
                                        </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                            <div id='detail_pane'>
                                <div id='details'>
                                    <h2>Unique Resources:</h2>
                                    <table style="width: 100%; margin-bottom: 0;">
                                    </table>
                                </div>
                                <br></br>
                                <div id='instance_details'>
<<<<<<< HEAD
                                <!--
                                    <b>Number of Checkins</b>
=======
                                    <h2>Details:</h2>
>>>>>>> fdc4754a8f034d6b879d506cca2d2afc1a070f0a
                                    <table style="width: 100%; margin-bottom: 0;">
                                    </table>
                                 -->
                                </div>
                            </div>
                            <div id='max_pane'>
                                <br></br>
                                <div id='max_details'>
                                	<b><span>Please generate a report first and then click the Max Usage link.</span></b>
                                </div>
                            </div>
                            <div id='import_pane'>
                                <div>
                                </div>
                                <br></br>
                                <button id='createAnotherReport_button' class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" onclick='importData()'>
                                    <span class='ui-button-text'>Import Data</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Login Form -->
        <div id="login-form" title="Login">
            <form>{% csrf_token %}
                <fieldset>
                    <label for="username">Username</label><br>
                    <input type="text" name="username" id="username" class="text ui-widget-content ui-corner-all" /><br>
                    <label for="password">Password</label><br>
                    <input type="password" name="password" id="password" class="text ui-widget-content ui-corner-all" />
                </fieldset>
            </form>
            <div id="login-error" class="ui-state-error">
                <div class="ui-state-error-text">
                    <p>Invalid Username or Password.</p>
                    <p>Please try again.</p>
                </div>
            </div>
            <div id="relogin" class="ui-helper-hidden">
                <p>Your session has expired, you must relogin.</p>
            </div>
        </div>
    </body>
</html>
